<style>
.dropdown {
    position: relative;
    display: inline-block;
}
.dropdown-content {
    display: none;
    position: absolute;
    right: 0;
    min-width: 220px;
    background-color: rgba(255, 255, 255, 0.98);
    backdrop-filter: blur(10px);
    border-radius: 2px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    padding: 0.5rem 0;
    margin-top: 0.5rem;
    border: 1px solid rgba(44, 44, 44, 0.1);
    z-index: 1000;
}
.dropdown-header {
    padding: 1.2rem;
    border-bottom: 1px solid rgba(44, 44, 44, 0.08);
    text-align: center;
    background: rgba(44, 44, 44, 0.02);
}
.dropdown-header .user-name {
    font-family: 'Montserrat', sans-serif;
    font-weight: 500;
    color: #2C2C2C;
    margin-bottom: 0.25rem;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 1px;
}
.dropdown-header .user-email {
    font-family: 'Montserrat', sans-serif;
    font-size: 0.8rem;
    color: #666666;
    letter-spacing: 0.5px;
}
.dropdown-content a {
    color: #2C2C2C;
    padding: 0.85rem 1.2rem;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    transition: all 0.3s ease;
    font-size: 0.85rem;
    font-family: 'Montserrat', sans-serif;
    letter-spacing: 0.5px;
}
.dropdown-content a:hover {
    background: rgba(44, 44, 44, 0.03);
    color: #000;
}
.dropdown-content a svg {
    transition: transform 0.3s ease;
    color: #2C2C2C;
    opacity: 0.8;
}
.dropdown-content a:hover svg {
    transform: translateX(2px);
    opacity: 1;
}
.dropdown-content .logout-link {
    border-top: 1px solid rgba(44, 44, 44, 0.08);
    color: #d32f2f;
}
.dropdown-content .logout-link:hover {
    color: #b71c1c;
    background: rgba(211, 47, 47, 0.03);
}
.dropdown:hover .dropdown-content {
    display: block;
    animation: dropdownFade 0.3s ease-out;
}
@keyframes dropdownFade {
    from { 
        opacity: 0; 
        transform: translateY(-8px); 
    }
    to { 
        opacity: 1; 
        transform: translateY(0); 
    }
}
.nav-link {
    font-family: 'Montserrat', sans-serif;
    position: relative;
    font-size: 0.85rem;
    letter-spacing: 1.5px;
    padding-bottom: 2px;
    color: #2C2C2C;
    transition: color 0.3s ease;
}
.nav-link::after {
    content: '';
    position: absolute;
    width: 0;
    height: 1px;
    bottom: -1px;
    left: 0;
    background-color: #2C2C2C;
    transition: width 0.3s ease;
}
.nav-link:hover::after {
    width: 100%;
}
.nav-link:hover {
    color: #000;
}
.search-input {
    font-family: 'Montserrat', sans-serif;
    border-bottom: 1px solid rgba(44, 44, 44, 0.2);
    transition: all 0.3s ease;
    letter-spacing: 0.5px;
}
.search-input:focus {
    border-bottom: 1px solid rgba(44, 44, 44, 0.8);
}
.search-input::placeholder {
    color: rgba(44, 44, 44, 0.4);
    letter-spacing: 0.5px;
}
.header {
    position: relative;
    z-index: 500;
}
.brand-name {
    font-family: 'Henny Penny', cursive;
    letter-spacing: 3px;
    font-size: 2.2rem;
    color: #2C2C2C;
    position: relative;
    transition: opacity 0.3s ease;
}
.brand-name:hover {
    opacity: 0.8;
}
.top-banner {
    font-family: 'Montserrat', sans-serif;
    letter-spacing: 1.5px;
    font-size: 0.7rem;
    padding: 0.6rem 0;
    background: #2C2C2C;
}
.dropdown-content {
    display: none !important; 
}

.dropdown:hover .dropdown-content,
.dropdown-content.show {
    display: block !important;
    animation: dropdownFade 0.3s ease-out;
}
</style>

<div class="w-full bg-[#2C2C2C] text-white text-xs py-1">
    <div class="flex justify-center items-center">
        <p class="text-center tracking-wider">FREE SHIPPING WORLD WIDE ON ALL PRE-PAID ORDERS</p>
    </div>
</div>

<div id="mainHeader" class="w-full bg-transparent border-b border-[#2C2C2C] border-opacity-10 sticky top-0 z-50 transition-colors duration-300 backdrop-blur-sm">
    <div class="max-w-[1400px] mx-auto px-6">
        <div class="hidden md:flex justify-between items-center py-4">
            <div class="flex items-center w-1/3">
                <div class="flex gap-8 justify-between">
                    <a href="/shop" class="nav-link">SHOP ALL</a>
                    <a href="/featured" class="nav-link">FEATURED</a>
                    <a href="/new-arrivals" class="nav-link">NEW ARRIVALS</a>
                </div>
            </div>

            <div class="flex justify-center w-1/3">
                <a href="/" class="brand-name font-henny">REVIVO</a>
            </div>

            <div class="flex items-center justify-end w-1/3 gap-6">
                <input type="text" 
                    placeholder="Search" 
                    class="search-input text-sm px-3 py-1 bg-transparent focus:outline-none w-36">
                
                <div id="auth-state">
                    <% if(locals.user){ %>
                        <div class="dropdown"> 
                            <button class="nav-link flex items-center gap-1">
                                <%= locals.user.name %>
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 9l-7 7-7-7"/>
                                </svg>
                            </button>
                            <div class="dropdown-content">
                                <div class="dropdown-header">
                                    <div class="user-name"><%= locals.user.name %></div>
                                    <div class="user-email"><%= locals.user.email %></div>
                                </div>
                                <a href="/profile">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                    </svg>
                                    Profile
                                </a>
                                <a href="/profile#orders">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
                                    </svg>
                                    Orders
                                </a>
                                <a href="/wishlist">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                    </svg>
                                    Wishlist
                                </a>
                                <a href="/logout" class="logout-link">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                                    </svg>
                                    Logout
                                </a>
                            </div>
                        </div>
                    <% } else { %>
                        <a href="/login" class="nav-link">LOGIN</a>
                    <% } %>
                </div>
                
<a href="/cart" class="nav-link relative">
  BAG 
  <span id="cart-count" class="absolute -top-2 -right-2 bg-[#f8c78d] text-[#2C2C2C] text-xs rounded-full w-5 h-5 flex items-center justify-center">
    <%= locals.cartCount || 0 %>
  </span>
</a>
            </div>
        </div>

        <div class="md:hidden py-3">
            <div class="flex justify-between items-center">
                <button id="burger-menu" class="p-2 text-[#2C2C2C] transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>

                <a href="/" class="brand-name font-henny text-2xl">REVIVO</a>

                <a href="/cart" class="p-2 nav-link">
                    <span class="text-sm">BAG (0)</span>
                </a>
            </div>

            <div id="mobile-menu" class="hidden pt-3 space-y-2">
                <input type="text" 
                    placeholder="Search" 
                    class="search-input w-full text-sm px-3 py-1 bg-transparent focus:outline-none text-center">
                <a href="/shop" class="nav-link block text-center py-2">SHOP ALL</a>
                <a href="/featured" class="nav-link block text-center py-2">FEATURED</a>
                <a href="/new-arrivals" class="nav-link block text-center py-2">NEW ARRIVALS</a>
                <a href="/login" class="nav-link block text-center py-2">MEMBERS</a>
            </div>
        </div>
    </div>
</div>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Henny+Penny&family=Montserrat:wght@300;400;500&display=swap');
    
    .font-henny {
        font-family: 'Henny Penny', cursive;
    }
</style>
<script>
    window.addEventListener('load', function() {
        const burgerMenu = document.getElementById('burger-menu');
        if (burgerMenu) {
            burgerMenu.addEventListener('click', function() {
                const mobileMenu = document.getElementById('mobile-menu');
                if (mobileMenu) {
                    mobileMenu.classList.toggle('hidden');
                }
            });
        }

        document.addEventListener('click', function(event) {
            const dropdownBtn = event.target.closest('.dropdown > button');
            if (dropdownBtn) {
                event.preventDefault();
                const dropdown = dropdownBtn.parentElement;
                const dropdownContent = dropdown.querySelector('.dropdown-content');
                
                document.querySelectorAll('.dropdown-content').forEach(content => {
                    if (content !== dropdownContent) {
                        content.style.display = 'none';
                    }
                });
                
                dropdownContent.style.display = dropdownContent.style.display === 'block' ? 'none' : 'block';
            } else {
                if (!event.target.closest('.dropdown')) {
                    document.querySelectorAll('.dropdown-content').forEach(content => {
                        content.style.display = 'none';
                    });
                }
            }
        });

        window.addEventListener('scroll', function() {
            const header = document.getElementById('mainHeader');
            if (header) {
                if (window.scrollY > 0) {
                    header.classList.add('bg-white');
                    header.classList.remove('bg-transparent');
                } else {
                    header.classList.remove('bg-white');
                    header.classList.add('bg-transparent');
                }
            }
        });

        async function checkSession() {
            try {
                const response = await fetch('/api/check-session');
                if (!response.ok) throw new Error('Network response was not ok');
                
                const { loggedIn, user } = await response.json();
                const authSection = document.getElementById('auth-state');
                
                if (authSection) {
                    const serverLoggedIn = loggedIn;
                    const clientLoggedIn = !!authSection.querySelector('.dropdown');
                    
                    if (serverLoggedIn !== clientLoggedIn) {
                        if (serverLoggedIn) {
                            authSection.innerHTML = `
                                <div class="dropdown"> 
                                    <button class="nav-link flex items-center gap-1">
                                        ${user.name}
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 9l-7 7-7-7"/>
                                        </svg>
                                    </button>
                                    <div class="dropdown-content" style="display: none">
                                        <div class="dropdown-header">
                                            <div class="user-name">${user.name}</div>
                                            <div class="user-email">${user.email}</div>
                                        </div>
                                        <a href="/profile">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                            </svg>
                                            Profile
                                        </a>
                                        <a href="/profile#orders">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
                                            </svg>
                                            Orders
                                        </a>
                                        <a href="/wishlist">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                            </svg>
                                            Wishlist
                                        </a>
                                        <a href="/logout" class="logout-link">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                                            </svg>
                                            Logout
                                        </a>
                                    </div>
                                </div>
                            `;
                        } else {
                            authSection.innerHTML = '<a href="/login" class="nav-link">LOGIN</a>';
                        }
                    }
                }
            } catch (error) {
                console.error('Session check failed:', error);
            }
        }
        
        checkSession();
        
        setInterval(checkSession, 300000);
    });
</script>

